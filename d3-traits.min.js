/*! d3-traits - v0.0.1 - 2014-03-21
* https://github.com/gec/d3-traits
* Copyright (c) 2014 d3-traits; Licensed ,  */
!function(a){function b(a,b){for(var c in a)c in b||(b[c]=a[c])}function c(a,b){var c=a[b];return c||(a[b]={},c=a[b]),c}function d(a){return"x"===a.charAt(0)}function e(a){return"y"===a.charAt(0)}function f(a){return a[a.length-1]}function g(b,c){return a.max(b,function(a){return c(a).length})>0}function h(a){return"[object Date]"!==Object.prototype.toString.call(a)?!1:!isNaN(a.getTime())}function i(b,c){return a.trait.utils.isX(c)?[b.minRangeMarginLeft(c),b.chartWidth()-b.minRangeMarginRight(c)]:[b.chartHeight()-b.minRangeMarginBottom(c),b.minRangeMarginTop(c)]}function j(a,b){var c=parseFloat(a);return isNaN(c)?b:c}function k(a,b){if(!a)return b;var c={};return c.top=j(a.top,b.top),c.right=j(a.right,b.right),c.bottom=j(a.bottom,b.bottom),c.left=j(a.left,b.left),c}function l(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function m(){var a,b,c,d,e=arguments[0]||{},f=arguments.length;for(a=1;f>a;a++)if(null!=(b=arguments[a]))for(c in b)d=b[c],d&&(e[c]=d);return e}function n(a,b){for(var c in b)a.hasOwnProperty(c)||b[c]&&(a[c]=b[c]);return a}function o(a,b){var c=l(a);return c||(c={}),n(c,b)}function p(a,b,c){function d(a,b){return"_"+a+"_"+b}function e(a,b,c){return console.log("makeVirtual "+a),function(a,b){return function(){var a=this._super;this._super=c;var d=b.apply(this,arguments);return this._super=a,d}}(a,b)}console.log("trait( "+a.name+")");var f,g,h=this;h.config=b,h._super=c,h.index=-1,h.getImp=function(){return g},h.trait=function(a,b){var c=new p(a,b,g);return c.getImp()},h.call=function(a){return this._super&&this._super.call(a),a.call(g),g},h.__replaceVirtual=function(a,b){g.hasOwnProperty(a)&&(g[a]=b),c&&c.__replaceVirtual(a,b)},h.__virtualize=function(b,d){console.log("__virtualize begin "+a.name+" name="+b);var f=null;return g.hasOwnProperty(b)&&"function"==typeof g[b]?(console.log("__virtualize "+a.name+" name="+b+" hasFunction"),f=e(b,d,g[b]),g[b]=f,c&&c.__replaceVirtual(b,f)):console.log("__virtualize "+a.name+" name="+b+" hasFunction NOT  "),f},h.__makeVTable=function(){console.log("__makeVTable begin "+a.name);var b,d;for(b in g)d=c.__virtualize(b,g[b]),d?(console.log(a.name+".__makeVTable name "+b+"   virtualized"),g[b]=d):console.log(a.name+".__makeVTable name "+b+" ! virtualized");for(b in c)b in g||(g[b]=c[b]);console.log("__makeVTable end")},h.__getRoot=function(){return h._super?h._super.__getRoot():h},f=d(a.name,h._traitIndex),c&&(h.config=o(b,h.__getRoot().config)),g=a(c,h.config,f),c&&h.__makeVTable(),g.call=h.call,g.trait=h.trait,g.getImp=h.getImp,g.config=h.config,g.__makeVTable=h.__makeVTable,g.__virtualize=h.__virtualize,g.__replaceVirtual=h.__replaceVirtual,g.__getRoot=h.__getRoot,g._super=c}function q(a,b){return new p(a,b).getImp()}Array.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},p.prototype={trait:function(a,b){var c=new p(a,b,this),d=c.getImp();return d},__getRoot:function(){return this._super?this._super.__getRoot():this},callInstance:function(a){var b=this;a.call(function(a){a.each(function(c){b(c,a)})})},call:function(a,b){return b||(b=this),this.__leafTrait=b,this._super&&this._super.call(a,b),a.call(this),this}},p.prototype.constructor=p,a.selection.prototype.trait=function(a,c){if(Array.isArray(a))for(var d in a)this.trait(a[d]);else{this._traitsInitialize();var e=this.traits.length,f={};e>0&&(f=this.traits[e-1]);var g=o(this._traitsConfig,c),h=a(f,g,this);b(f,h),this.call(h),this.traits.push(h)}return this},a.selection.prototype.callTraits=function(){for(var a in this.traits){var b=this.traits[a];this.call(b)}return this};var r={};a.selection.prototype._traitsInitialize=function(){return this._traitsConfig||(this._traitsConfig=l(r)),this.traits||(this.traits=[]),this},a.selection.prototype.traitConfig=function(a){this._traitsInitialize();for(var b in a)this._traitsConfig[b]=a[b];return this},a.trait=q,a.trait.scale={},a.trait.chart={utils:{}},a.trait.axis={},a.trait.control={},a.trait.focus={},a.trait.legend={},a.trait.utils={clone:l,extend:m,isX:d,isY:e,isData:g,isValidDate:h,extentMax:f,getChartRange:i,getTraitCache:c,configMargin:k,configFloat:j}}(d3),function(a,b){function c(a,b){arguments.length<=0?(this.x=0,this.y=0):(this.x=a,this.y=b)}function d(a,b){arguments.length<=0?(this.width=0,this.height=0):(this.width=a,this.height=b)}function e(){var a,b;switch(arguments.length){case 0:this.top=0,this.right=0,this.bottom=0,this.left=0;break;case 1:a=arguments[0],this.top=a,this.right=a,this.bottom=a,this.left=a;break;case 2:a=arguments[0],b=arguments[1],this.top=a,this.right=b,this.bottom=a,this.left=b;break;case 3:this.top=arguments[0],this.right=arguments[1],this.bottom=arguments[2],this.left=arguments[1];break;case 4:this.top=arguments[0],this.right=arguments[1],this.bottom=arguments[2],this.left=arguments[3]}}function f(a,b,e,f,g,h){switch(arguments.length){case 0:this.origin=new c(0,0),this.size=new d(0,0),this.anchor=new c(0,0);break;case 2:this.origin=new c(a.x,a.y),this.size=new d(b.width,b.height),this.anchor=new c(0,0);break;case 3:this.origin=new c(a.x,a.y),this.size=new d(b.width,b.height),this.anchor=new c(e.x,e.y);break;case 4:this.origin=new c(a,b),this.size=new d(e,f),this.anchor=new c(0,0);break;case 6:this.origin=new c(a,b),this.size=new d(e,f),this.anchor=new c(g,h)}this.minX=function(){return this.origin.x-this.size.width*this.anchor.x},this.maxX=function(){return this.origin.x+this.size.width*(1-this.anchor.x)},this.minY=function(){return this.origin.y-this.size.height*this.anchor.y},this.maxY=function(){return this.origin.y+this.size.height*(1-this.anchor.y)},this.spaceOnTop=function(a){return this.minY()-a.maxY()},this.spaceOnBottom=function(a){return a.minY()-this.maxY()},this.roomOnRight=function(a){return a.maxX()-this.maxX()},this.roomOnBottom=function(a){return a.maxY()-this.maxY()},this.roomOnLeft=function(a){return this.minX()-a.minX()},this.roomOnTop=function(a){return this.minY()-a.minY()},this.translate=function(a){this.origin.x+=a.x,this.origin.y+=a.y}}function g(a,b){return a.rect.origin.y-b.rect.origin.y}function h(a,b){for(var c=null,d=a.length-1;d>=0;d--){var e,f=a[d],g=f.rect;e=d===a.length-1?b-g.maxY():c.rect.spaceOnTop(g),0>e&&(g.origin.y+=e),c=f}}function i(a,b,c){var d=0;c>0?d=-c-b:0>b&&(d=-b),a.origin.y+=d}function j(a,b,c){var d,e=null;a.forEach(function(a,f){d=a.rect,0===f?i(d,d.roomOnTop(b),c):i(d,d.spaceOnTop(e.rect),c),e=a})}function k(a,b,c,d){for(var e,f=b;c>f;f++)e=a[f],e.rect.origin.y+=d}function l(a,b,c){for(var d,e,f,g=0,h=0,i=0,j=0,l=null,m=0,n=0;g<a.length;g++){if(f=a[g],d=f.rect,e=0===g?d.roomOnTop(b):d.spaceOnTop(l.rect),e>0)if(i>0){if(n=m/i,-1>n||n>1){var o=n;n=n>0?Math.min(n,j):-Math.min(-n,e),k(a,h,g,-n),j-=n,e+=n,e>0?(i=1,h=g,j=e,m=0):(m=(o-n)*i,i++,m+=d.origin.y-c[g])}}else i=1,h=g,j=e,m+=d.origin.y-c[g];else i++,m+=d.origin.y-c[g];l=f}if(i>1&&(n=m/i,-1>n||n>1)){if(n>0)n=Math.min(n,j);else{var p=l.rect.roomOnBottom(b);n=p>0?-Math.min(-n,p):0}k(a,h,g,-n)}}function m(b,c){if(!(b.length<=0)){b.sort(g);var d=0,e=0,f=c.size.height,i=a.sum(b,function(a){return a.rect.size.height}),k=b.map(function(a){return a.rect.origin.y});i>f?e=(i-f)/b.length:d=f-i,j(b,c,e),d>0&&(h(b,c.maxY()),l(b,c,k))}}function n(a,b){var c,d=[],e=[];return a.forEach(function(a){c=a.rect,c.anchor.x<.5?c.roomOnRight(b)>=0?(a.orient=r,e.push(a)):(a.orient=q,c.anchor.x=1,d.push(a)):c.roomOnLeft(b)>=0?(a.orient=q,d.push(a)):(a.orient=r,c.anchor.x=0,e.push(a))}),[d,e]}function o(a,b){var c=n(a,b);m(c[0],b),m(c[1],b)}function p(a,b,c,d){var e,f,g=0;switch(c){case"left":g=b.minX(),a.forEach(function(a){e=a.rect,e.origin.x+=g-e.minX(),g=e.maxX()});break;case"right":for(g=b.maxX(),f=a.length-1;f>=0;f--)e=a[f].rect,e.origin.x+=g-e.maxX(),g=e.minX();break;case"top":g=b.minY(),a.forEach(function(a){e=a.rect,e.origin.y+=g-e.minY(),g=e.maxY()});break;case"bottom":for(g=b.maxY(),f=a.length-1;f>=0;f--)e=a[f].rect,e.origin.y+=g-e.maxY(),g=e.minY()}}var q=-1,r=1;b.layout||(b.layout={utils:{}}),b.Point=c,b.Size=d,b.Margin=e,b.Rect=f,b.layout.adjustOrientationToFitWidth=n,b.layout.vertical=m,b.layout.byOrientation=p,b.layout.verticalAnchorLeftRight=o,b.layout.utils.listNudgeUpFromBottom=h,b.layout.utils.removeOverlapFromTop=j,b.layout.utils.listBalanceFromTop=l}(d3,d3.trait),function(a,b){function c(a,b){return b?b:"x"===a?"bottom":"left"}function d(a){var b=a.axis,d=b.charAt(0),e={name:b,axisChar:d,accessData:a[b],orient:c(d,a.orient),ticks:a.ticks,extentTicks:a.extentTicks||!1,tickSize:a.tickSize,tickPadding:a.tickPadding,tickFormat:a.tickFormat,nice:a.nice,label:a.label};return e.labelLineHeight=e.label?a.labelLineHeight||14:0,e.axisMargin=a.axisMargin||40+e.labelLineHeight,e}function e(a,b,c){if(!b.label)return null;var d,e,f=c.node().getBBox(),g=Math.round(f.width/2);switch(b.axisMargin-b.labelLineHeight,b.orient){case"left":return d=-b.axisMargin+b.labelLineHeight,e=a.chartHeight()/2+g,"translate( "+d+","+e+") rotate( -90)";case"bottom":return d=a.chartWidth()/2-g,e=b.axisMargin-b.labelLineHeight,"translate( "+d+","+e+")";case"top":return d=a.chartWidth()/2-g,e=-b.axisMargin+b.labelLineHeight,"translate( "+d+","+e+")";case"right":return d=b.axisMargin-b.labelLineHeight,e=a.chartHeight()/2-g,"translate( "+d+","+e+") rotate( 90)";default:return null}}function f(a,b,c){c.extentTicks?a.tickValues(b.domain()):c.ticks&&a.ticks(c.ticks),c.tickSize&&a.tickSize(c.tickSize),c.tickPadding&&a.tickPadding(c.tickPadding),c.tickFormat&&a.tickFormat(c.tickFormat)}function g(b,c){function g(b){var c=g;b.each(function(){h||(h=this._container.append("g").classed("axis",!0),i=h.append("g").classed("axis-"+l.name,!0),l.label&&(j=h.append("text").classed("axis-label axis-label-"+l.name,!0)),k=a.svg.axis()),k.scale(m).orient(l.orient),f(k,m,l),c.layoutAxis(h,l.orient,l.axisMargin),l.label&&(j.text(l.label),j.attr({transform:e(c,l,j)})),i.call(k)})}var h,i,j,k,l=d(c),m=b[l.name]();return g.update=function(a,c){return this._super(a,c),f(k,m,l),0===c?i.call(k):i.transition().duration(c||b.duration()).ease("linear").call(k),this},b.onChartResized("axisLinear-"+l.name,g),b.onRangeMarginChanged("axisLinear-"+l.name,g),g}function h(b,c){function g(b){var c=g;b.each(function(){h||(h=this._container.append("g").classed("axis",!0),i=h.append("g").classed("axis-"+n.name,!0),n.label&&(j=h.append("text").classed("axis-label axis-label-"+n.name,!0)),l=a.svg.axis());var b=o.domain();m.range(o.range()),m.domain(o.domain()),n.nice&&m.nice(n.nice),l.scale(m).orient(n.orient),f(l,m,n),c.layoutAxis(h,n.orient,n.axisMargin),n.label&&(j.text(n.label),j.attr({transform:e(c,n,j)})),h.call(l);var d=h.selectAll("path.axis-extension").data(a.trait.utils.isValidDate(b[0])?[b[0]]:[]);d.transition().attr("class","axis-extension").attr("d",function(a){return"M0,0L"+m(a)+",0"}),d.enter().append("path").attr("class","axis-extension").attr("d",function(a){return"M0,0L"+m(a)+",0"}),k=a.trait.utils.extentMax(b)})}var h,i,j,k,l=a.svg.axis(),m=a.time.scale(),n=d(c),o=b[n.name]();return g.update=function(c,d){this._super(c,d),m.range(a.trait.utils.getChartRange(b,n.name));var e=o.domain(),f=a.trait.utils.extentMax(e),g=f.getTime()-k.getTime(),i=new Date(e[0].getTime()+g);return m.domain([i,f]),k=f,0===d?h.call(l):h.transition().duration(d||b.duration()).ease("linear").call(l),this},b.onChartResized("axisMonth-"+n.name,g),b.onRangeMarginChanged("axisMonth-"+n.name,g),g}b.axis.linear=g,b.axis.time||(b.axis.time={}),b.axis.time.month=h}(d3,d3.trait),function(a,b){function c(c,d){function e(b){var c=e;b.each(function(b){if(!f){var e=d.chartClass?"chart-area "+d.chartClass:"chart-area";f=this._chartGroup.append("g").classed(e,!0)}var j=d.seriesFilter?b.filter(d.seriesFilter):b;k.y0(c.chartHeight()),g=f.selectAll(".series").data(j),g.selectAll("path").transition().duration(500).attr("d",function(a){return k(d.seriesData(a))}),g.enter().append("g").attr("class","series").append("path").attr("class","area").attr("d",function(a){return k(d.seriesData(a))}).style("fill",c.color),h=a.trait.utils.extentMax(i.domain())})}var f,g,h,i=c.x1(),j=c.y1(),k=a.svg.area().interpolate(d.interpolate||"linear").x(function(a){return i(d.x1(a))}).y0(c.chartHeight()).y1(function(a){return j(d.y1(a))}),l=a.dispatch("customHover");return e.update=function(a,e){this._super(a,e);var f=e||c.duration(),j=function(a){return k(d.seriesData(a))};return h=b.chart.utils.updatePathWithTrend(a,f,i,g,j,h),this},a.rebind(e,l,"on"),c.onChartResized("chartArea",e),e}b.chart.area=c}(d3,d3.trait),function(a,b){function c(a,b,c,d,e,f){return{x:function(c){return e(a.x1(c))+b},y:function(b){return f(a.y1(b))},width:c,height:function(b){return d-f(a.y1(b))}}}function d(b,d){function e(a,b,c){var d,e=Number.MAX_VALUE,f=a.length;if(2>f)return 0;var g,h=c(b(a[0]));for(d=1;f>d;d++)g=c(b(a[d])),e=Math.min(e,g-h),h=g;return e}function f(b){var q=f;b.each(function(b){var f=d.seriesFilter?b.filter(d.seriesFilter):b,r=a.min(f,function(a){return e(d.seriesData(a),d.x1,m)});if(j=Math.floor(.9*r-o),k=Math.round(o/2-j/2),q.minRangeMarginLeft("x1",Math.ceil(o/2+.4*j+j/2)),!g){var s=d.chartClass?"chart-bar "+d.chartClass:"chart-bar";g=this._chartGroup.append("g").classed(s,!0)}h=g.selectAll(".series").data(f),h.enter().append("g").attr("class","series").style("fill",q.color),i=h.selectAll("rect").data(d.seriesData),i.transition().duration(500).delay(500).ease(q.ease()).attr(c(d,k,j,q.chartHeight(),m,n)),i.enter().append("rect").classed("bar",!0).attr(c(d,k,j,q.chartHeight(),m,n)).on("mouseover",p.customHover),i.exit().transition().style({opacity:0}).remove(),l=a.trait.utils.extentMax(m.domain())})}var g,h,i,j,k,l,m=b.x1(),n=b.y1(),o=0;d.barCount;var p=a.dispatch("customHover");return f.update=function(e,f){this._super(e,f);var g=a.trait.utils.extentMax(m.domain()),o=m(l)-m(g);return h.attr("transform",null),i.attr(c(d,k,j,b.chartHeight(),m,n)),i=h.selectAll("rect").data(d.seriesData),i.enter().append("rect").classed("bar",!0).attr(c(d,k,j,b.chartHeight(),m,n)),i.exit().transition().style({opacity:0}).remove(),0===f?h.attr("transform","translate("+o+")"):h.transition().duration(f||b.duration()).ease("linear").attr("transform","translate("+o+")"),l=a.trait.utils.extentMax(m.domain()),this},f.gap=function(a){return arguments.length?(o=a,this):o},a.rebind(f,p,"on"),b.onChartResized("chartBar",f),b.onRangeMarginChanged("chartBar",f),f}b.chart.bar=d}(d3,d3.trait),function(a,b){function c(c,e){function f(a){D[a]||(D[a]=b.utils.clone(F))}function g(a,b){if(!arguments.length)return{};if(f(a),1===arguments.length)return D[a];if(!b)return this;var c=D[a],d=!1;return console.log("=============== rangeMargin="+b+" left="+b.left),b.left&&c.left<b.left&&(c.left=b.left,d=!0),b.right&&c.right<b.right&&(c.right=b.right,d=!0),b.top&&c.top<b.top&&(c.top=b.top,d=!0),b.bottom&&c.bottom<b.bottom&&(c.bottom=b.bottom,d=!0),d&&W.rangeMarginChanged(),this}function h(a,b){var c="chart-group-clip-path-"+d;return a._chartGroupClipPath=b.append("clipPath").attr("id",c),a._chartGroupClipPathRect=a._chartGroupClipPath.append("rect").attr("width",O).attr("height",P),d++,c}function i(a,b,c){return a[0]>=0&&a[0]<=b&&a[1]>=0&&a[1]<=c}function j(a,b,c){return a?c:b}function k(a,b,c,d){return a?d.indexOf("%")>=0?d:c:b}function l(a,b,c,d){var e={};return e.width=k(b,c,a.offsetWidth,a.style.width),e.height=k(b,d,a.offsetHeight,a.style.height),e}function m(b,c,d,e){return new a.trait.Size(j(c,d,b.offsetWidth),j(c,e,b.offsetHeight))}function n(b){var c=n;I=b,b.each(function(b){var d=this,e=l(d,K,M,N);if(H=a.select(d),!d._svg){d._svg=a.select(d).append("svg").classed("chart",!0).attr("width",e.width).attr("height",e.height),d._svgDefs=d._svg.append("defs"),L=m(d,K,M,N),M=L.width,N=L.height,O=L.width-C.left-C.right,P=L.height-C.top-C.bottom;var f=h(d,d._svgDefs);d._container=d._svg.append("g").classed("container-group",!0),d._chartGroup=d._container.append("g").classed("chart-group",!0),d._chartGroup.attr("clip-path","url(#"+f+")"),this._svg.on("mousemove",function(){var b,e=a.mouse(d._chartGroup.node()),f=i(e,O,P),g=new a.trait.Point(e[0],e[1]);b=f?c.getFocusItems.call(d,g):[],b.forEach(function(a){a.point.x+=C.left,a.point.y+=C.top}),o(d,b)&&p(d,b,g),d.__onFocusChangeLastFoci=b}),this._svg.on("mouseout",function(){var b=a.mouse(d._chartGroup.node()),c=i(b,O,P);c||q(d)}),S=[],b.forEach(function(a){var b;a.__color__&&(b=S.indexOf(a.__color__),b>=0?delete a.__color__:S.push(a.__color__))})}console.log("chartBase w="+M+", h="+N+" cW="+O+", cH="+P),d._svg.transition().duration(T).attr({width:M,height:N}),d._svg.select(".chart-group").attr("transform","translate("+C.left+","+C.top+")"),d._chartGroupClipPathRect.attr("width",O).attr("height",P),T=500})}function o(a,b){var c=a.__onFocusChangeLastFoci;if(!c||c.length!==b.length)return!0;for(var d,e,f=c.length-1;f>=0;f--)if(d=c[f],e=b[f],d.index!==e.index||d.point.x!==e.point.x||d.point.y!==e.point.y)return!0;return!1}function p(a,b,c){r(a,"__onFocusChangeListeners",[b,c])}function q(a){r(a,"__onChartMouseOutListeners",[])}function r(a,b,c){if(a[b])for(var d,e=0,f=a[b],g=f.length;g>e;e++)d=f[e],d.apply(a,c)}function s(){var a={chartWidth:O,chartHeight:P};O=M-C.left-C.right,P=N-C.top-C.bottom,(a.chartWidth!==O||a.chartHeight!==P)&&(I&&I.call(n),W.chartResized())}function t(){var a={width:M,height:N};M=O+C.left+C.right,N=P+C.top+C.bottom,(a.width!==M||a.height!==N)&&W.chartResized()}function u(a){var b,c,d=E.length;for(b=0;d>b;b++)if(c=E[b],c.axisGroup===a)return c;return null}function v(a,b){var c,d=!1;if(a.length<=0)return d;switch(b){case"left":c=a[a.length-1].rect.maxX(),C.left<c&&(C.left=c,d=!0);break;case"right":c=M-a[0].rect.minX(),C.right<c&&(C.right=c,d=!0);break;case"top":c=a[a.length-1].rect.maxY(),C.top<c&&(C.top=c,d=!0);break;case"bottom":c=N-a[0].rect.minY(),C.bottom<c&&(C.bottom=c,d=!0)}return d}function w(a){var b=!1;return a.forEach(function(a){a.rect.minY()<C.top&&(a.rect.origin.y=C.top,b=!0)}),b}function x(a){var b=!1;return a.forEach(function(a){a.rect.minX()<C.left&&(a.rect.origin.x=C.left,b=!0)}),b}function y(a,b){var c=!1,d=0,e=0;if(a.length<=0)return c;switch(b){case"left":c=w(a),d=a[a.length-1].rect.maxX(),d<C.left&&(e=C.left-d,a.forEach(function(a){a.rect.origin.x+=e}),c=!0);break;case"right":c=w(a),d=a[0].rect.minX(),d>M-C.right&&(e=M-C.right-d,a.forEach(function(a){a.rect.origin.x+=e}),c=!0);break;case"top":c=x(a),d=a[a.length-1].rect.maxY(),d<C.top&&(e=C.top-d,a.forEach(function(a){a.rect.origin.y+=e}),c=!0);break;case"bottom":c=x(a),d=a[0].rect.minY(),d>N-C.bottom&&(e=N-C.bottom-d,a.forEach(function(a){a.rect.origin.y+=e}),c=!0)}return c}function z(b,c){switch(b){case"left":return new a.trait.Rect(0,0,c,0,1,0);case"right":return new a.trait.Rect(0,0,c,0);case"top":return new a.trait.Rect(0,0,0,c,0,1);case"bottom":return new a.trait.Rect(0,0,0,c);default:return new a.trait.Rect}}function A(){var b,c,d=!1,e=new a.trait.Rect(0,0,M,N),f=["left","right","top","bottom"],g={};f.forEach(function(c){b=E.filter(function(a){return a.orient===c}),a.trait.layout.byOrientation(b,e,c),d=d||v(b,c),g[c]=b});for(c in g)b=g[c],y(b,c);d&&s()}function B(a){if(a.__color__)return a.__color__;for(var b,c=0;10>c&&(a.__color__=R(Q++),b=S.indexOf(a.__color__),!(0>b));)c++;return S.push(a.__color__),a.__color__}e||(e={}),e.seriesData||(e.seriesData=function(a){return a});var C=a.trait.utils.configMargin(e.margin,{top:5,right:5,bottom:5,left:5}),D={},E=[],F={left:0,right:0,top:0,bottom:0};if(e.minRangeMargin)for(var G in e.minRangeMargin)g(G,e.minRangeMargin[G]);var H,I,J="cubic-in-out",K=!0,L=new a.trait.Size,M=200,N=100,O=M-C.left-C.right,P=N-C.top-C.bottom,Q=0,R=a.scale.category10(),S=[],T=0,U="chartResized",V="rangeMarginChanged",W=a.dispatch(U,V);return n.onFocusChange=function(a,b){a.__onFocusChangeListeners||(a.__onFocusChangeListeners=[]),b&&a.__onFocusChangeListeners.push(b)},n.onChartMouseOut=function(a,b){a.__onChartMouseOutListeners||(a.__onChartMouseOutListeners=[]),b&&a.__onChartMouseOutListeners.push(b)},n.remove=function(){I.each(function(){var a=this;a._svg&&(a._svg.remove(),delete a._svg,delete a._svgDefs,delete a._container,delete a._chartGroup,delete a._chartGroupClipPath,delete a._chartGroupClipPathRect,delete a.__onFocusChangeListeners,delete a.__onChartMouseOutListeners)})},n.layoutAxis=function(a,b,c){var d=u(a),e=z(b,c);d?(d.orient!==b||d.rect.size!==e.size)&&(d.orient=b,d.rect=e,A()):(d={axisGroup:a,orient:b,rect:e},E.push(d),A()),d.axisGroup.attr("transform","translate("+d.rect.origin.x+","+d.rect.origin.y+")")},n.getFocusItems=function(){return[]},n.update=function(){},n.select=function(){return H},n.color=function(a,b){switch(arguments.length){case 1:return B(a);case 3:return B(a);case 2:return a.__color__=b,this;default:return"black"}},n.width=function(a){return arguments.length?(K=!1,M=parseInt(a,10),s(),this):M},n.height=function(a){return arguments.length?(K=!1,N=parseInt(a,10),s(),T=0,this):N},n.marginTop=function(a){return arguments.length?(C.top=a,s(),this):C.top},n.marginBottom=function(a){return arguments.length?(C.bottom=a,s(),this):C.bottom},n.marginLeft=function(a){return arguments.length?(C.left=a,s(),this):C.left},n.marginRight=function(a){return arguments.length?(C.right=a,s(),this):C.right},n.plusMarginTop=function(a){return C.top+=parseInt(a,10),s(),this},n.plusMarginBottom=function(a){return C.bottom+=parseInt(a,10),s(),this},n.plusMarginLeft=function(a){return C.left+=parseInt(a,10),s(),this},n.plusMarginRight=function(a){return C.right+=parseInt(a,10),s(),this},n.chartRect=function(){return new a.trait.Rect(C.left,C.top,O,P)},n.chartWidth=function(a){return arguments.length?(O=parseInt(a,10),t(),this):O},n.chartHeight=function(a){return arguments.length?(P=parseInt(a,10),t(),this):P},n.ease=function(a){return arguments.length?(J=a,this):J},n.duration=function(a){return arguments.length?(T=a,this):T},n.onChartResized=function(a,b){var c=U;a&&a.length>0&&(c=c+"."+a),W.on(c,function(){I&&I.call(b)})},n.minRangeMargin=g,n.minRangeMarginLeft=function(a,b){return arguments.length?1===arguments.length?D[a]?D[a].left:0:(f(a),D[a].left<b&&(D[a].left=b,W.rangeMarginChanged()),this):0},n.minRangeMarginRight=function(a,b){return arguments.length?1===arguments.length?D[a]?D[a].right:0:(f(a),D[a].right<b&&(D[a].right=b,W.rangeMarginChanged()),this):0},n.minRangeMarginTop=function(a,b){return arguments.length?1===arguments.length?D[a]?D[a].top:0:(f(a),D[a].top<b&&(D[a].top=b,W.rangeMarginChanged()),this):0},n.minRangeMarginBottom=function(a,b){return arguments.length?1===arguments.length?D[a]?D[a].bottom:0:(f(a),D[a].bottom<b&&(D[a].bottom=b,W.rangeMarginChanged()),this):0},n.onRangeMarginChanged=function(a,b){var c=V;a&&a.length>0&&(c=c+"."+a),b?W.on(c,function(){I&&I.call(b)}):W.on(c)},n}var d=1;b.chart.base=c}(d3,d3.trait),function(a,b){function c(c,d){function e(b){var c=e;b.each(function(b){if(!l){var e=d.chartClass?"chart-line "+d.chartClass:"chart-line";l=this._chartGroup.append("g").classed(e,!0)}n=d.seriesFilter?b.filter(d.seriesFilter):b,m=l.selectAll(".series").data(n),m.selectAll("path").transition().duration(500).attr("d",function(a){return u(d.seriesData(a))}),m.enter().append("g").attr("class","series").append("path").attr("class","line").attr("d",function(a){return u(d.seriesData(a))}).style("stroke",c.color),m.exit().transition().style({opacity:0}).remove(),o=a.trait.utils.extentMax(q.domain())})}function f(a,b,c,d,e,f){var g,h;for(void 0===e&&(e=0),void 0===f&&(f=a.length-1);f>=e;)if(g=Math.floor((e+f)/2),h=b(a[g]),c>h)e=g+1;else{if(!(h>c))return g;f=g-1}return 0>d?0>e+d?0:e+d:f+d>=a.length?a.length-1:f+d}function g(b,c,d){var e,g,h,i,j=b.length-1,k=c.range(),l=a.trait.utils.extentMax(k);return e=c.invert(k[0]),g=c.invert(l),h=f(b,d,e,-1),i=f(b,d,g,1,h,j),i++,b.slice(h,i)}function h(a,b){return b.x>a.x?b.x-a.x:a.x-b.x}function i(a,b){return b.y>a.y?b.y-a.y:a.y-b.y}function j(a,b){var c=h(a,b),d=i(a,b);return Math.sqrt(c*c+d*d)}function k(b,c,e,f){var g,i,k,l;return g=c[e],i=new a.trait.Point(q(d.x1(g)),r(s.y(g))),k=j(i,f),l=h(i,f),{series:b,index:e,item:g,point:i,distance:k,distanceX:l}}var l,m,n,o,p=d.yAxis||"y1",q=c.x1(),r=c[p](),s={x:d.x1,y:d[p]},t=a.trait.chart.utils.configFocus(d),u=a.svg.line().interpolate(d.interpolate||"linear").x(function(a){return q(s.x(a))}).y(function(a){return r(s.y(a))});return e.update=function(a,e){this._super(a,e);var f=e||c.duration(),h=function(a){return u(g(d.seriesData(a),q,d.x1))};return o=b.chart.utils.updatePathWithTrend(a,f,q,m,h,o),this},e.getFocusItems=function(b){var c=e,f=this._super(b),g=new a.trait.Point(q.invert(b.x),r.invert(b.y)),h=a.bisector(d.x1).left;return n.forEach(function(a){var e,i,j=d.seriesData(a),l=h(j,g.x);if(l>=j.length&&(l=j.length-1),e=k(a,j,l,b),i=e.index-1,i>=0){var m=k(a,j,i,b);"x"===t.axis?m.distanceX<e.distanceX&&(e=m):m.distance<e.distance&&(e=m)}e.distance<=t.distance&&(e.color=c.color(a),f.push(e))}),f},c.onChartResized("chartLine",e),e}b.chart.line=c}(d3,d3.trait),function(a,b){function c(a,b,c,d,e,f){return{x:function(c){return e(a.x1(c))+b},y:function(b){return f(a.y1(b))},width:c,height:function(b){return d-f(a.y1(b))}}}function d(a,b,c){return{cx:function(c){return b(a.x1(c))},cy:function(b){return c(a.y1(b))},r:8}}function e(b,e){function f(b){var c=f;b.each(function(b){var f=this,j=e.seriesFilter?b.filter(e.seriesFilter):b;if(!g){var k=e.chartClass?"chart-scatter "+e.chartClass:"chart-scatter";g=this._chartGroup.append("g").classed(k,!0)}h=g.selectAll(".series").data(j),h.enter().append("g").attr("class","series").style("fill",c.color),i=h.selectAll(o).data(e.seriesData),i.transition().duration(500).delay(500).ease(c.ease()).attr(d(e,m,n)),i.enter().append(o).classed("scatter-point",!0).attr(d(e,m,n)).on("mouseover",function(a){return f._svg.append("text").text("data: "+e.y1(a).toFixed(1)).attr("id","tooltip").attr("x",m(e.x1(a))+10).attr("y",n(e.y1(a))).attr("fill","black").attr("opacity",0).style("font-family","sans-serif").transition().attr("opacity",1)}).on("mouseout",function(){a.select(this).transition().duration(500).attr("fill","slateblue"),a.selectAll("#tooltip").transition().duration(500).attr("opacity",0).remove()}),i.exit().transition().style({opacity:0}).remove(),l=a.trait.utils.extentMax(m.domain())})}var g,h,i,j,k,l,m=b.x1(),n=b.y1(),o="circle",p=a.dispatch("customHover");return f.update=function(d,f){this._super(d,f);var g=a.trait.utils.extentMax(m.domain()),o=m(l)-m(g);return h.attr("transform",null),i.attr(c(e,k,j,b.chartHeight(),m,n)),i=h.selectAll("rect").data(e.seriesData),i.enter().append("rect").classed("bar",!0).attr(c(e,k,j,b.chartHeight(),m,n)),i.exit().transition().style({opacity:0}).remove(),0===f?h.attr("transform","translate("+o+")"):h.transition().duration(f||b.duration()).ease("linear").attr("transform","translate("+o+")"),l=a.trait.utils.extentMax(m.domain()),this},a.rebind(f,p,"on"),b.onChartResized("chartScatter",f),b.onRangeMarginChanged("chartScatter",f),f}b.chart.scatter=e}(d3,d3.trait),function(a,b){function c(b,c,d,e,f,g){var h=a.trait.utils.extentMax(d.domain());if("trend"===b){var i=d(g)-d(h);e.attr("transform",null),e.selectAll("path").attr("d",f),0!==c&&c?e.transition().duration(c).ease("linear").attr("transform","translate("+i+")"):e.attr("transform","translate("+i+")")}else e.selectAll("path").attr("d",f);return h}function d(b){var c={distance:14,axis:null};return b.focus&&(c.distance=a.trait.utils.configFloat(b.focus.distance,c.distance),c.axis=b.focus.axis),c}b.chart.utils.updatePathWithTrend=c,b.chart.utils.configFocus=d}(d3,d3.trait),function(a,b){function c(b,c){function d(){var a=m.empty()?j.domain():m.extent();k[l+"Domain"](a),k.update("domain",0)}function e(b){var d=e;b.each(function(){if(!f){var b="brush brush-"+h,e=c.chartClass?b+c.chartClass:b;f=this._chartGroup.append("g").classed(e,!0).call(m)}f.selectAll("rect").attr("y",-6).attr("height",d.chartHeight()+7),g=a.trait.utils.extentMax(j.domain())})}var f,g,h=c.axis,i=h.charAt(0),j=b[h](),k=c.target,l=c.targetAxis,m=(k[c.targetAxis](),a.svg.brush()[i](j));m.on("brush",d);var n=a.dispatch("customHover");return e.update=function(b,c){return this._super(b,c),g=a.trait.utils.extentMax(j.domain()),this},a.rebind(e,n,"on"),b.onChartResized("controlBrush",e),e}b.control.brush=c}(d3,d3.trait),function(a,b){function c(a,b){return"l"+a+","+b}function d(a,b,c,d){return"q"+a+","+b+" "+c+","+d}function e(a,b){return"m"+a+","+b}function f(a){return Math.max(.16*a,6)}function g(a,b,f,g,h,i){var j=h.x<.5?1:-1,k=Math.floor(b/2-g-f),l=2*k+2*g,m=Math.floor(a-f-f),n=e(0,0+i)+c(2*j*g,-g-i)+c(0,-k)+d(0,-f,j*f,-f)+c(j*m,0)+d(j*f,0,j*f,f)+c(0,l)+d(0,f,j*-f,f)+c(j*-m,0)+d(j*-f,0,j*-f,-f)+c(0,-k)+"z";return n}function h(a){a.forEach(function(a){a&&(a.remove=!0)})}function i(a){a.forEach(function(b,c){b&&b.remove&&(b.group.remove(),a[c]=null)})}function j(a){delete a.lastFoci,a.tooltips&&a.tooltips.forEach(function(b,c){b&&(b.group.remove(),a.tooltips[c]=null)})}function k(b,c,d){function e(b){var n=e;b.each(function(b){var e=this,o=a.trait.utils.getTraitCache(e,d);o.tooltips=b.map(function(){return null}),n.onChartMouseOut(e,function(){j(o)}),n.onFocusChange(e,function(d){if(d.length<=0)return j(o),void 0;var p=new a.trait.Point(0,.5);h(o.tooltips),d.forEach(function(d){var g=b.indexOf(d.series),h=o.tooltips[g],i=l(c.x1(d.item))+" "+c.y1(d.item);h||(h={newby:!0},h.group=e._container.append("g").attr({id:"tooltip",opacity:0}),h.path=h.group.append("path").attr("fill","darkgray"),h.text=h.group.append("text").attr({"font-family":"monospace","font-size":10,fill:"black","text-rendering":"geometric-precision"}),o.tooltips[g]=h),h.remove=!1,h.text.text(i);var j=h.text.node().getBBox();j.height=2*j.height+2*m,j.width+=2*m+f(j.height),d.rect=new a.trait.Rect(d.point,j,p)}),a.trait.layout.verticalAnchorLeftRight(d,n.chartRect()),d.forEach(function(c){var d=b.indexOf(c.series),e=o.tooltips[d],h=a.rgb(c.color).darker(1.4).toString(),i=c.point.y-c.rect.origin.y,j=f(c.rect.size.height),l=g(c.rect.size.width,c.rect.size.height,k,j,c.rect.anchor,i),n=2*j+m,p=c.rect.anchor.x<.5?n:-c.rect.size.width-n;e.text.attr("transform","translate("+p+","+0+")"),e.newby?(e.group.attr("transform","translate("+c.rect.origin.x+","+c.rect.origin.y+")"),e.group.transition().attr("opacity",1)):e.group.transition().attr({opacity:1,transform:"translate("+c.rect.origin.x+","+c.rect.origin.y+")"}),e.path.transition().attr({opacity:.72,fill:c.color,stroke:h,d:l}),e.newby=!1}),i(o.tooltips),o.lastFoci=d})})}a.trait.utils.configFloat(c.distance,14),c.axis;var k=4,m=3;return e}var l=a.time.format("%Y-%m-%d");b.focus.tooltip=k}(d3,d3.trait),function(a,b){function c(b,c){function d(){return"top"===g||"bottom"===g}function e(){var a,d={left:2,right:2};return c.legendMargin&&(d.left=c.legendMargin.left||d.left,d.right=c.legendMargin.right||d.right,d.top=c.legendMargin.top,d.bottom=c.legendMargin.bottom),d.left+=b.marginLeft(),d.right+=b.marginRight(),a="margin-left:"+d.left+"px;",a+="margin-right:"+d.right+"px;",d.top&&(a+="margin-top:"+d.top+"px;"),d.bottom&&(a+="margin-bottom:"+d.bottom+"px;"),a}function f(b){var h=f;b.each(function(b){if(!this._legend){var f=c.legendClass?"legend "+c.legendClass:"legend";if(d()){var i=a.select(this);this._legend="top"===g?i.insert("ul","svg"):i.append("ul"),this._legend.attr("style",e()).attr("class",f)}else this._legend=this._container.append("g").classed(f,!0)}var j=c.legendFilter?b.filter(c.legendFilter):b;if(d()){var k=this._legend.selectAll("li").data(j);k.enter().append("li").attr("class","legend-item").style("border-bottom-color",h.color).text(c.seriesLabel)}else{var l=this._legend.selectAll(".legend").data(j);l.enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"}),l.append("rect").attr("x",h.chartWidth()-18).attr("width",18).attr("height",18).style("fill",h.color),l.append("text").attr("x",h.chartWidth()-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(c.seriesLabel)}})}var g=c.orient||"top",h=a.dispatch("customHover");return a.rebind(f,h,"on"),b.onChartResized("legendSeries",f),f
}b.legend.series=c}(d3,d3.trait),function(a,b){function c(a){return q.indexOf(a)>=0}function d(a,b){return{series:a.seriesData,data:a[b]}}function e(b){var c=a.trait.utils.configFloat(b.domainMin,null),d=a.trait.utils.configFloat(b.domainMax,null),e={trend:b.trend};return null!==c&&null!==d?e.domain=[c,d]:null!==c||null!=d?(e.domainMin=c,e.domainMax=d):e.domain=b.domain,e}function f(b,c){return a.min(b,function(b){return a.min(c.series(b),c.data)})}function g(b,c){return a.max(b,function(b){return a.max(c.series(b),c.data)})}function h(b,c){var d,e,f;return d=b.map(function(b){return a.extent(c.series(b),c.data)}),e=a.min(d,function(a){return a[0]}),f=a.max(d,function(a){return a[1]}),[e,f]}function i(a,b){var d,e=b.count||1;return d=c(b.interval)?b.interval.offset(a,0-e):a instanceof Date?a.getTime()-b.interval*e:a-b.interval*e}function j(a,b,c){var d,e,f;return a.track===p?(e=new Date,d=i(e,a.domain),f=[d,e]):a.domain&&a.domain.interval?(e=g(b,c),d=i(e,a.domain),f=[d,e]):f=h(b,c),f}function k(a,b,c){if(a.domain)return a.domain;var d;return d=a.trend?j(a,b,c):null!=a.domainMin?[a.domainMin,g(b,c)]:null!=a.domainMax?[f(b,c),a.domainMax]:h(b,c)}function l(a,b,c,d,e){var f,j,k,l,m,n;if(a.range(b),c.domain)return a.domain(c.domain),void 0;if(l=a.domain(),m=l[l.length-1],c.trend){var o=c.trend;o.track===p?(j=new Date,f=i(j,o.domain),a.domain([f,j])):o.domain&&o.domain.interval?(j=g(d,e),f=i(m,o.domain),a.domain([f,m]),n=a(j),f=i(j,o.domain),a.domain([f,j]),a.range([b[0],n])):(k=h(d,e),a.domain(k))}else k=h(d,e),a.domain(k)}function m(b,c){function d(a){var b=d;a.each(function(a){var d;e=c.seriesFilter?a.filter(c.seriesFilter):a;var f="x"===g?b.chartWidth():b.chartHeight();i.rangeRoundBands([0,f],.1),d=e[0].map(h),i.domain(d)})}var e,f=c.axis,g=f.charAt(0),h=c[f],i=a.scale.ordinal();return d[f]=function(){return i},d}function n(b,c){function f(b){var d=f;b.each(function(b){g=c.seriesFilter?b.filter(c.seriesFilter):b,m.domain(k(j,g,i)),c.nice&&m.nice(c.nice),m.range(a.trait.utils.getChartRange(d,h))})}var g,h=c.axis,i=(h.charAt(0),d(c,h)),j=e(c),m=a.time.scale();return b.minRangeMargin(h,c.minRangeMargin),f[h]=function(){return m},f[h+"Domain"]=function(a){j.domain=a,m.domain(a)},f.update=function(c,d){this._super(c,d);var e=a.trait.utils.getChartRange(b,h);return l(m,e,j,g,i),this},b.onChartResized("scaleTime"+h,f),b.onRangeMarginChanged("scaleTime-"+h,f),f}function o(b,c){function f(b){var d=f;b.each(function(b){g=c.seriesFilter?b.filter(c.seriesFilter):b,m.domain(k(j,g,i)),m.range(a.trait.utils.getChartRange(d,h))})}var g,h=c.axis,i=(h.charAt(0),d(c,h)),j=e(c),m=a.scale.linear();return b.minRangeMargin(c.axis,c.minRangeMargin),f[h]=function(){return m},f.update=function(c,d){this._super(c,d);var e=a.trait.utils.getChartRange(b,h);return l(m,e,j,g,i),this},b.onChartResized(h,f),f}var p="current-time",q=[a.time.second,a.time.minute,a.time.hour,a.time.day,a.time.week,a.time.month,a.time.year];b.scale.ordinal||(b.scale.ordinal={}),b.scale.linear=o,b.scale.ordinal.bars=m,b.scale.time=n}(d3,d3.trait);